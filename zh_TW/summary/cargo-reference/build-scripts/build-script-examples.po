msgid ""
msgstr ""
"Project-Id-Version: The Cargo Book\n"
"POT-Creation-Date: 2026-01-24T08:43:57Z\n"
"PO-Revision-Date: \n"
"Last-Translator: \n"
"Language-Team: \n"
"Language: zh_TW\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=1; plural=0;\n"

#: src/reference/build-script-examples.md:1
msgid "Build Script Examples"
msgstr "建置腳本範例"

#: src/reference/build-script-examples.md:3
msgid ""
"The following sections illustrate some examples of writing build scripts."
msgstr ""

#: src/reference/build-script-examples.md:5
msgid ""
"Some common build script functionality can be found via crates on [crates.io]"
"(https://crates.io/). Check out the [`build-dependencies` keyword](https://"
"crates.io/keywords/build-dependencies) to see what is available. The "
"following is a sample of some popular crates[^†]:"
msgstr ""

#: src/reference/build-script-examples.md:10
msgid ""
"[`bindgen`](https://crates.io/crates/bindgen) — Automatically generate Rust "
"FFI bindings to C libraries."
msgstr ""

#: src/reference/build-script-examples.md:12
msgid "[`cc`](https://crates.io/crates/cc) — Compiles C/C++/assembly."
msgstr ""

#: src/reference/build-script-examples.md:13
msgid ""
"[`pkg-config`](https://crates.io/crates/pkg-config) — Detect system "
"libraries using the `pkg-config` utility."
msgstr ""

#: src/reference/build-script-examples.md:15
msgid ""
"[`cmake`](https://crates.io/crates/cmake) — Runs the `cmake` build tool to "
"build a native library."
msgstr ""

#: src/reference/build-script-examples.md:16
msgid ""
"[`autocfg`](https://crates.io/crates/autocfg), [`rustc_version`](https://"
"crates.io/crates/rustc_version), [`version_check`](https://crates.io/crates/"
"version_check) — These crates provide ways to implement conditional "
"compilation based on the current `rustc` such as the version of the compiler."
msgstr ""

#: src/reference/build-script-examples.md:22
msgid ""
"This list is not an endorsement. Evaluate your dependencies to see which is "
"right for your project."
msgstr ""

#: src/reference/build-script-examples.md:25
msgid "Code generation"
msgstr ""

#: src/reference/build-script-examples.md:27
msgid ""
"Some Cargo packages need to have code generated just before they are "
"compiled for various reasons. Here we’ll walk through a simple example which "
"generates a library call as part of the build script."
msgstr ""

#: src/reference/build-script-examples.md:31
msgid "First, let’s take a look at the directory structure of this package:"
msgstr ""

#: src/reference/build-script-examples.md:43
msgid ""
"Here we can see that we have a `build.rs` build script and our binary in "
"`main.rs`. This package has a basic manifest:"
msgstr ""

#: src/reference/build-script-examples.md:46
msgid ""
"```toml\n"
"# Cargo.toml\n"
"\n"
"[package]\n"
"name = \"hello-from-generated-code\"\n"
"version = \"0.1.0\"\n"
"```"
msgstr ""

#: src/reference/build-script-examples.md:54
msgid "Let’s see what’s inside the build script:"
msgstr ""

#: src/reference/build-script-examples.md:57
#: src/reference/build-script-examples.md:157
#: src/reference/build-script-examples.md:210
#: src/reference/build-script-examples.md:314
#: src/reference/build-script-examples.md:401
msgid "// build.rs\n"
msgstr ""

#: src/reference/build-script-examples.md:64
#: src/reference/build-script-examples.md:103
#: src/reference/build-script-examples.md:164
msgid "\"OUT_DIR\""
msgstr ""

#: src/reference/build-script-examples.md:65
msgid "\"hello.rs\""
msgstr ""

#: src/reference/build-script-examples.md:68
msgid ""
"\"pub fn message() -> &'static str {\n"
"            \\\"Hello, World!\\\"\n"
"        }\n"
"        \""
msgstr ""

#: src/reference/build-script-examples.md:73
#: src/reference/build-script-examples.md:318
msgid "\"cargo:rerun-if-changed=build.rs\""
msgstr ""

#: src/reference/build-script-examples.md:77
msgid "There’s a couple of points of note here:"
msgstr ""

#: src/reference/build-script-examples.md:79
msgid ""
"The script uses the `OUT_DIR` environment variable to discover where the "
"output files should be located. It can use the process’ current working "
"directory to find where the input files should be located, but in this case "
"we don’t have any input files."
msgstr ""

#: src/reference/build-script-examples.md:83
msgid ""
"In general, build scripts should not modify any files outside of `OUT_DIR`. "
"It may seem fine on the first blush, but it does cause problems when you use "
"such crate as a dependency, because there's an _implicit_ invariant that "
"sources in `.cargo/registry` should be immutable. `cargo` won't allow such "
"scripts when packaging."
msgstr ""

#: src/reference/build-script-examples.md:88
msgid ""
"This script is relatively simple as it just writes out a small generated "
"file. One could imagine that other more fanciful operations could take place "
"such as generating a Rust module from a C header file or another language "
"definition, for example."
msgstr ""

#: src/reference/build-script-examples.md:92
msgid ""
"The [`rerun-if-changed` instruction](build-scripts.md#rerun-if-changed) "
"tells Cargo that the build script only needs to re-run if the build script "
"itself changes. Without this line, Cargo will automatically run the build "
"script if any file in the package changes. If your code generation uses some "
"input files, this is where you would print a list of each of those files."
msgstr ""

#: src/reference/build-script-examples.md:98
msgid "Next, let’s peek at the library itself:"
msgstr ""

#: src/reference/build-script-examples.md:101
#: src/reference/build-script-examples.md:249
msgid "// src/main.rs\n"
msgstr ""

#: src/reference/build-script-examples.md:103
msgid "\"/hello.rs\""
msgstr ""

#: src/reference/build-script-examples.md:106
msgid "\"{}\""
msgstr ""

#: src/reference/build-script-examples.md:110
msgid ""
"This is where the real magic happens. The library is using the rustc-defined "
"[`include!` macro](../../std/macro.include.html) in combination with the "
"[`concat!`](../../std/macro.concat.html) and [`env!`](../../std/macro.env."
"html) macros to include the generated file (`hello.rs`) into the crate’s "
"compilation."
msgstr ""

#: src/reference/build-script-examples.md:115
msgid ""
"Using the structure shown here, crates can include any number of generated "
"files from the build script itself."
msgstr ""

#: src/reference/build-script-examples.md:122
msgid "Building a native library"
msgstr ""

#: src/reference/build-script-examples.md:124
msgid ""
"Sometimes it’s necessary to build some native C or C++ code as part of a "
"package. This is another excellent use case of leveraging the build script "
"to build a native library before the Rust crate itself. As an example, we’ll "
"create a Rust library which calls into C to print “Hello, World!”."
msgstr ""

#: src/reference/build-script-examples.md:129
msgid "Like above, let’s first take a look at the package layout:"
msgstr ""

#: src/reference/build-script-examples.md:142
msgid "Pretty similar to before! Next, the manifest:"
msgstr ""

#: src/reference/build-script-examples.md:144
msgid ""
"```toml\n"
"# Cargo.toml\n"
"\n"
"[package]\n"
"name = \"hello-world-from-c\"\n"
"version = \"0.1.0\"\n"
"edition = \"2018\"\n"
"```"
msgstr ""

#: src/reference/build-script-examples.md:153
msgid ""
"For now we’re not going to use any build dependencies, so let’s take a look "
"at the build script now:"
msgstr ""

#: src/reference/build-script-examples.md:166
msgid ""
"// Note that there are a number of downsides to this approach, the comments\n"
"    // below detail how to improve the portability of these commands.\n"
msgstr ""

#: src/reference/build-script-examples.md:168
msgid "\"gcc\""
msgstr ""

#: src/reference/build-script-examples.md:168
#: src/reference/build-script-examples.md:214
msgid "\"src/hello.c\""
msgstr ""

#: src/reference/build-script-examples.md:168
msgid "\"-c\""
msgstr ""

#: src/reference/build-script-examples.md:168
msgid "\"-fPIC\""
msgstr ""

#: src/reference/build-script-examples.md:168
msgid "\"-o\""
msgstr ""

#: src/reference/build-script-examples.md:169
msgid "\"{}/hello.o\""
msgstr ""

#: src/reference/build-script-examples.md:171
msgid "\"ar\""
msgstr ""

#: src/reference/build-script-examples.md:171
msgid "\"crus\""
msgstr ""

#: src/reference/build-script-examples.md:171
msgid "\"libhello.a\""
msgstr ""

#: src/reference/build-script-examples.md:171
msgid "\"hello.o\""
msgstr ""

#: src/reference/build-script-examples.md:175
msgid "\"cargo:rustc-link-search=native={}\""
msgstr ""

#: src/reference/build-script-examples.md:176
msgid "\"cargo:rustc-link-lib=static=hello\""
msgstr ""

#: src/reference/build-script-examples.md:177
#: src/reference/build-script-examples.md:216
msgid "\"cargo:rerun-if-changed=src/hello.c\""
msgstr ""

#: src/reference/build-script-examples.md:181
msgid ""
"This build script starts out by compiling our C file into an object file (by "
"invoking `gcc`) and then converting this object file into a static library "
"(by invoking `ar`). The final step is feedback to Cargo itself to say that "
"our output was in `out_dir` and the compiler should link the crate to "
"`libhello.a` statically via the `-l static=hello` flag."
msgstr ""

#: src/reference/build-script-examples.md:187
msgid "Note that there are a number of drawbacks to this hard-coded approach:"
msgstr ""

#: src/reference/build-script-examples.md:189
msgid ""
"The `gcc` command itself is not portable across platforms. For example it’s "
"unlikely that Windows platforms have `gcc`, and not even all Unix platforms "
"may have `gcc`. The `ar` command is also in a similar situation."
msgstr ""

#: src/reference/build-script-examples.md:192
msgid ""
"These commands do not take cross-compilation into account. If we’re cross "
"compiling for a platform such as Android it’s unlikely that `gcc` will "
"produce an ARM executable."
msgstr ""

#: src/reference/build-script-examples.md:196
msgid ""
"Not to fear, though, this is where a `build-dependencies` entry would help! "
"The Cargo ecosystem has a number of packages to make this sort of task much "
"easier, portable, and standardized. Let's try the [`cc` crate](https://"
"crates.io/crates/cc) from [crates.io](https://crates.io/). First, add it to "
"the `build-dependencies` in `Cargo.toml`:"
msgstr ""

#: src/reference/build-script-examples.md:202
msgid ""
"```toml\n"
"[build-dependencies]\n"
"cc = \"1.0\"\n"
"```"
msgstr ""

#: src/reference/build-script-examples.md:207
msgid "And rewrite the build script to use this crate:"
msgstr ""

#: src/reference/build-script-examples.md:215
#: src/reference/build-script-examples.md:335
msgid "\"hello\""
msgstr ""

#: src/reference/build-script-examples.md:220
msgid ""
"The [`cc` crate](https://crates.io/crates/cc) abstracts a range of build "
"script requirements for C code:"
msgstr ""

#: src/reference/build-script-examples.md:222
msgid ""
"It invokes the appropriate compiler (MSVC for windows, `gcc` for MinGW, `cc` "
"for Unix platforms, etc.)."
msgstr ""

#: src/reference/build-script-examples.md:224
msgid ""
"It takes the `TARGET` variable into account by passing appropriate flags to "
"the compiler being used."
msgstr ""

#: src/reference/build-script-examples.md:226
msgid ""
"Other environment variables, such as `OPT_LEVEL`, `DEBUG`, etc., are all "
"handled automatically."
msgstr ""

#: src/reference/build-script-examples.md:228
msgid ""
"The stdout output and `OUT_DIR` locations are also handled by the `cc` "
"library."
msgstr ""

#: src/reference/build-script-examples.md:231
msgid ""
"Here we can start to see some of the major benefits of farming as much "
"functionality as possible out to common build dependencies rather than "
"duplicating logic across all build scripts!"
msgstr ""

#: src/reference/build-script-examples.md:235
msgid ""
"Back to the case study though, let’s take a quick look at the contents of "
"the `src` directory:"
msgstr ""

#: src/reference/build-script-examples.md:239
msgid "// src/hello.c\n"
msgstr ""

#: src/reference/build-script-examples.md:241
msgid "<stdio.h>"
msgstr ""

#: src/reference/build-script-examples.md:244
msgid "\"Hello, World!\\n\""
msgstr ""

#: src/reference/build-script-examples.md:250
msgid ""
"// Note the lack of the `#[link]` attribute. We’re delegating the "
"responsibility\n"
"// of selecting what to link over to the build script rather than hard-"
"coding\n"
"// it in the source file.\n"
msgstr ""

#: src/reference/build-script-examples.md:261
msgid ""
"And there we go! This should complete our example of building some C code "
"from a Cargo package using the build script itself. This also shows why "
"using a build dependency can be crucial in many situations and even much "
"more concise!"
msgstr ""

#: src/reference/build-script-examples.md:265
msgid ""
"We’ve also seen a brief example of how a build script can use a crate as a "
"dependency purely for the build process and not for the crate itself at "
"runtime."
msgstr ""

#: src/reference/build-script-examples.md:270
msgid "Linking to system libraries"
msgstr ""

#: src/reference/build-script-examples.md:272
msgid ""
"This example demonstrates how to link a system library and how the build "
"script is used to support this use case."
msgstr ""

#: src/reference/build-script-examples.md:275
msgid ""
"Quite frequently a Rust crate wants to link to a native library provided on "
"the system to bind its functionality or just use it as part of an "
"implementation detail. This is quite a nuanced problem when it comes to "
"performing this in a platform-agnostic fashion. It is best, if possible, to "
"farm out as much of this as possible to make this as easy as possible for "
"consumers."
msgstr ""

#: src/reference/build-script-examples.md:282
msgid ""
"For this example, we will be creating a binding to the system's zlib "
"library. This is a library that is commonly found on most Unix-like systems "
"that provides data compression. This is already wrapped up in the [`libz-"
"sys` crate](https://crates.io/crates/libz-sys), but for this example, we'll "
"do an extremely simplified version. Check out [the source code](https://"
"github.com/rust-lang/libz-sys) for the full example."
msgstr ""

#: src/reference/build-script-examples.md:288
msgid ""
"To make it easy to find the location of the library, we will use the [`pkg-"
"config` crate](https://crates.io/crates/pkg-config). This crate uses the "
"system's `pkg-config` utility to discover information about a library. It "
"will automatically tell Cargo what is needed to link the library. This will "
"likely only work on Unix-like systems with `pkg-config` installed. Let's "
"start by setting up the manifest:"
msgstr ""

#: src/reference/build-script-examples.md:294
msgid ""
"```toml\n"
"# Cargo.toml\n"
"\n"
"[package]\n"
"name = \"libz-sys\"\n"
"version = \"0.1.0\"\n"
"edition = \"2018\"\n"
"links = \"z\"\n"
"\n"
"[build-dependencies]\n"
"pkg-config = \"0.3.16\"\n"
"```"
msgstr ""

#: src/reference/build-script-examples.md:307
msgid ""
"Take note that we included the `links` key in the `package` table. This "
"tells Cargo that we are linking to the `libz` library. See [\"Using another "
"sys crate\"](#using-another-sys-crate) for an example that will leverage "
"this."
msgstr ""

#: src/reference/build-script-examples.md:311
msgid "The build script is fairly simple:"
msgstr ""

#: src/reference/build-script-examples.md:317
msgid "\"zlib\""
msgstr ""

#: src/reference/build-script-examples.md:322
msgid "Let's round out the example with a basic FFI binding:"
msgstr ""

#: src/reference/build-script-examples.md:325
msgid "// src/lib.rs\n"
msgstr ""

#: src/reference/build-script-examples.md:329
msgid "\"C\""
msgstr ""

#: src/reference/build-script-examples.md:342
msgid ""
"Run `cargo build -vv` to see the output from the build script. On a system "
"with `libz` already installed, it may look something like this:"
msgstr ""

#: src/reference/build-script-examples.md:351
msgid ""
"Nice! `pkg-config` did all the work of finding the library and telling Cargo "
"where it is."
msgstr ""

#: src/reference/build-script-examples.md:354
msgid ""
"It is not unusual for packages to include the source for the library, and "
"build it statically if it is not found on the system, or if a feature or "
"environment variable is set. For example, the real [`libz-sys` crate]"
"(https://crates.io/crates/libz-sys) checks the environment variable "
"`LIBZ_SYS_STATIC` or the `static` feature to build it from source instead of "
"using the system library. Check out [the source](https://github.com/rust-"
"lang/libz-sys) for a more complete example."
msgstr ""

#: src/reference/build-script-examples.md:365
msgid "Using another `sys` crate"
msgstr ""

#: src/reference/build-script-examples.md:367
msgid ""
"When using the `links` key, crates may set metadata that can be read by "
"other crates that depend on it. This provides a mechanism to communicate "
"information between crates. In this example, we'll be creating a C library "
"that makes use of zlib from the real [`libz-sys` crate](https://crates.io/"
"crates/libz-sys)."
msgstr ""

#: src/reference/build-script-examples.md:372
msgid ""
"If you have a C library that depends on zlib, you can leverage the [`libz-"
"sys` crate](https://crates.io/crates/libz-sys) to automatically find it or "
"build it. This is great for cross-platform support, such as Windows where "
"zlib is not usually installed. `libz-sys` [sets the `include` metadata]"
"(https://github.com/rust-lang/libz-sys/"
"blob/3c594e677c79584500da673f918c4d2101ac97a1/build.rs#L156) to tell other "
"packages where to find the header files for zlib. Our build script can read "
"that metadata with the `DEP_Z_INCLUDE` environment variable. Here's an "
"example:"
msgstr ""

#: src/reference/build-script-examples.md:381
msgid ""
"```toml\n"
"# Cargo.toml\n"
"\n"
"[package]\n"
"name = \"zuser\"\n"
"version = \"0.1.0\"\n"
"edition = \"2018\"\n"
"\n"
"[dependencies]\n"
"libz-sys = \"1.0.25\"\n"
"\n"
"[build-dependencies]\n"
"cc = \"1.0.46\"\n"
"```"
msgstr ""

#: src/reference/build-script-examples.md:396
msgid ""
"Here we have included `libz-sys` which will ensure that there is only one "
"`libz` used in the final library, and give us access to it from our build "
"script:"
msgstr ""

#: src/reference/build-script-examples.md:405
msgid "\"src/zuser.c\""
msgstr ""

#: src/reference/build-script-examples.md:406
msgid "\"DEP_Z_INCLUDE\""
msgstr ""

#: src/reference/build-script-examples.md:409
msgid "\"zuser\""
msgstr ""

#: src/reference/build-script-examples.md:410
msgid "\"cargo:rerun-if-changed=src/zuser.c\""
msgstr ""

#: src/reference/build-script-examples.md:414
msgid ""
"With `libz-sys` doing all the heavy lifting, the C source code may now "
"include the zlib header, and it should find the header, even on systems "
"where it isn't already installed."
msgstr ""

#: src/reference/build-script-examples.md:419
msgid "// src/zuser.c\n"
msgstr ""

#: src/reference/build-script-examples.md:421
msgid "\"zlib.h\""
msgstr ""

#: src/reference/build-script-examples.md:422
msgid "// … rest of code that makes use of zlib.\n"
msgstr ""

#: src/reference/build-script-examples.md:426
msgid "Conditional compilation"
msgstr ""

#: src/reference/build-script-examples.md:428
msgid ""
"A build script may emit [`rustc-cfg` instructions](build-scripts.md#rustc-"
"cfg) which can enable conditions that can be checked at compile time. In "
"this example, we'll take a look at how the [`openssl` crate](https://crates."
"io/crates/openssl) uses this to support multiple versions of the OpenSSL "
"library."
msgstr ""

#: src/reference/build-script-examples.md:433
msgid ""
"The [`openssl-sys` crate](https://crates.io/crates/openssl-sys) implements "
"building and linking the OpenSSL library. It supports multiple different "
"implementations (like LibreSSL) and multiple versions. It makes use of the "
"`links` key so that it may pass information to other build scripts. One of "
"the things it passes is the `version_number` key, which is the version of "
"OpenSSL that was detected. The code in the build script looks something "
"[like this](https://github.com/sfackler/rust-openssl/blob/"
"dc72a8e2c429e46c275e528b61a733a66e7877fc/openssl-sys/build/main.rs#L216):"
msgstr ""

#: src/reference/build-script-examples.md:442
msgid "\"cargo:version_number={:x}\""
msgstr ""

#: src/reference/build-script-examples.md:445
msgid ""
"This instruction causes the `DEP_OPENSSL_VERSION_NUMBER` environment "
"variable to be set in any crates that directly depend on `openssl-sys`."
msgstr ""

#: src/reference/build-script-examples.md:448
msgid ""
"The `openssl` crate, which provides the higher-level interface, specifies "
"`openssl-sys` as a dependency. The `openssl` build script can read the "
"version information generated by the `openssl-sys` build script with the "
"`DEP_OPENSSL_VERSION_NUMBER` environment variable. It uses this to generate "
"some [`cfg` values](https://github.com/sfackler/rust-openssl/blob/"
"dc72a8e2c429e46c275e528b61a733a66e7877fc/openssl/build.rs#L18-L36):"
msgstr ""

#: src/reference/build-script-examples.md:456
msgid "// (portion of build.rs)\n"
msgstr ""

#: src/reference/build-script-examples.md:458
msgid "\"DEP_OPENSSL_VERSION_NUMBER\""
msgstr ""

#: src/reference/build-script-examples.md:462
msgid "\"cargo:rustc-cfg=ossl101\""
msgstr ""

#: src/reference/build-script-examples.md:465
msgid "\"cargo:rustc-cfg=ossl102\""
msgstr ""

#: src/reference/build-script-examples.md:468
msgid "\"cargo:rustc-cfg=ossl110\""
msgstr ""

#: src/reference/build-script-examples.md:471
msgid "\"cargo:rustc-cfg=ossl110g\""
msgstr ""

#: src/reference/build-script-examples.md:474
msgid "\"cargo:rustc-cfg=ossl111\""
msgstr ""

#: src/reference/build-script-examples.md:479
msgid ""
"These `cfg` values can then be used with the [`cfg` attribute](../../"
"reference/conditional-compilation.md#the-cfg-attribute) or the [`cfg` macro]"
"(../../std/macro.cfg.html) to conditionally include code. For example, SHA3 "
"support was added in OpenSSL 1.1.1, so it is [conditionally excluded]"
"(https://github.com/sfackler/rust-openssl/blob/"
"dc72a8e2c429e46c275e528b61a733a66e7877fc/openssl/src/hash.rs#L67-L85) for "
"older versions:"
msgstr ""

#: src/reference/build-script-examples.md:486
msgid "// (portion of openssl crate)\n"
msgstr ""

#: src/reference/build-script-examples.md:494
msgid ""
"Of course, one should be careful when using this, since it makes the "
"resulting binary even more dependent on the build environment. In this "
"example, if the binary is distributed to another system, it may not have the "
"exact same shared libraries, which could cause problems."
msgstr ""
